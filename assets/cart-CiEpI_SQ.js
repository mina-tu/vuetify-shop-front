import{am as B,u as D,M as f,G as y,o as u,c as I,w as a,h as N,a as l,b as _,e as x,ar as c,Z as r,ao as p,as as k,av as P,i as S}from"./index-AtB5BXkw.js";import{b as $}from"./VList-CD8ix65k.js";import{v as A}from"./VDataTable-KZLTsv6M.js";import"./ssrBoot-BdtQdOe9.js";const T=k("h1",{class:"text-center"},"購物車",-1),E={key:0},G={key:1,class:"text-red"},F={__name:"cart",setup(M){const{apiAuth:h}=P(),C=S(),i=B(),v=D(),s=f([]),g=[{title:"品名",key:"p_id.name"},{title:"單價",key:"p_id.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:t=>t.p_id.price*t.quantity},{title:"操作",key:"action"}];(async()=>{var t,o;try{const{data:e}=await h.get("/user/cart");s.value=e.result}catch(e){console.log(e),i({text:((o=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const b=y(()=>s.value.reduce((t,o)=>t+o.quantity*o.p_id.price,0)),V=y(()=>s.value.length>0&&!s.value.some(t=>!t.p_id.sell)),m=f(!1),q=async()=>{m.value=!0;const t=await v.checkout();i({text:t.text,snackbarProps:{color:t.color}}),t.color==="green"&&C.push("/orders"),m.value=!1},d=async(t,o)=>{const e=await v.addCart(t,o);if(i({text:e.text,snackbarProps:{color:e.color}}),e.color==="green"){const n=s.value.findIndex(w=>w.p_id._id===t);s.value[n].quantity+=o,s.value[n].quantity<=0&&s.value.splice(n,1)}};return(t,o)=>(u(),I(N,null,{default:a(()=>[l(_,{cols:"12"},{default:a(()=>[T]),_:1}),l($),l(_,{cols:"12"},{default:a(()=>[l(A,{items:s.value,headers:g},{"item.p_id.name":a(({item:e})=>[e.p_id.sell?(u(),x("span",E,c(e.p_id.name),1)):(u(),x("span",G,c(e.p_id.name)+" (已下架)",1))]),"item.quantity":a(({item:e})=>[l(r,{variant:"text",color:"red",onClick:n=>d(e.p_id._id,-1)},{default:a(()=>[p("-")]),_:2},1032,["onClick"]),k("span",null,c(e.quantity),1),l(r,{variant:"text",color:"green",onClick:n=>d(e.p_id._id,1)},{default:a(()=>[p("+")]),_:2},1032,["onClick"])]),"item.action":a(({item:e})=>[l(r,{variant:"text",color:"red",icon:"mdi-delete",onClick:n=>d(e.p_id._id,e.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),l(_,{cols:"12",class:"text-center"},{default:a(()=>[k("p",null,"總金額: "+c(b.value),1),l(r,{color:"green",disabled:!V.value,onClick:q},{default:a(()=>[p("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1}))}};export{F as default};
