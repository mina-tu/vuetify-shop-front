import{_ as J,am as Q,M as u,r as W,o as L,e as X,a as l,w as s,h as Y,aw as _,F as h,av as ee,V as ae,b as N,Z as C,ao as w,ax as P,ay as le,I as te,c as oe,aq as re,az as se,d as t,g as ne,aA as ue,ar as ie,aB as de,aC as me,aa as pe}from"./index-AtB5BXkw.js";import{c as ve,a as A,b as ge,d as ce,u as fe,e as v}from"./vee-validate.esm-0JAnTC3A.js";import{b as j}from"./route-block-B_A1xBdJ.js";import{V as Ve,a as ye}from"./VDataTableServer-CghEk1v_.js";import{V as be}from"./VForm-BB16rMn2.js";import{V as ke}from"./VDataTable-KZLTsv6M.js";import{V as xe}from"./VTextarea-DIqG04sV.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VList-CD8ix65k.js";import"./ssrBoot-BdtQdOe9.js";const E={__name:"products",setup(Ce){const{apiAuth:U}=ee(),S=Q(),I=u(null),n=u({open:!1,id:""}),D=o=>{o?(n.value.id=o._id,g.value.value=o.name,c.value.value=o.year,f.value.value=o.description,V.value.value=o.category,y.value.value=o.sell):n.value.id="",n.value.open=!0},T=()=>{n.value.open=!1,O(),I.value.deleteFileRecord()},q=["原水處理系統規劃設計及施工","純水及超純水系統規劃設計及施工","特殊廢水回收系統規劃設計及施工","製程液純化系統規劃設計及施工","冷凝水回收系統規劃設計及施工","冷卻水塔旁濾系統規劃設計及施工","其他"],K=ve({name:A().required("業主名稱必填"),year:ge().typeError("年份格式錯誤").required("年份必填").min(0,"年份不能小於 0"),description:A().required("說明必填"),category:A().required("分類必填").test("isCategory","分類錯誤",o=>q.includes(o)),sell:ce()}),{handleSubmit:H,isSubmitting:$,resetForm:O}=fe({validationSchema:K,initialValues:{name:"",year:0,description:"",category:"",sell:!0}}),g=v("name"),c=v("year"),f=v("description"),V=v("category"),y=v("sell"),p=u([]),R=u([]),Z=H(async o=>{var e,d,a;if(!((e=p.value[0])!=null&&e.error)&&!(n.value.id.length===0&&p.value.length<1))try{const r=new FormData;r.append("name",o.name),r.append("year",o.year),r.append("description",o.description),r.append("category",o.category),r.append("sell",o.sell),p.value.length>0&&r.append("image",p.value[0].file),n.value.id===""?await U.post("/product",r):await U.patch("/product/"+n.value.id,r),S({text:n.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"green"}}),T(),i(!0)}catch(r){console.log(r),S({text:((a=(d=r==null?void 0:r.response)==null?void 0:d.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),B=u(10),b=u([{key:"createdAt",order:"desc"}]),k=u(1),F=u([]),G=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"業主",align:"center",sortable:!0,key:"name"},{title:"年份",align:"center",sortable:!0,key:"year"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"新增",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"action"}],M=u(!0),z=u(0),x=u(""),i=async o=>{var e,d,a,r;o&&(k.value=1),M.value=!0;try{const{data:m}=await U.get("/product/all",{params:{page:k.value,itemsPerPage:B.value,sortBy:((e=b.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((d=b.value[0])==null?void 0:d.order)||"desc",search:x.value}});F.value.splice(0,F.value.length,...m.result.data),z.value=m.result.total}catch(m){console.log(m),S({text:((r=(a=m==null?void 0:m.response)==null?void 0:a.data)==null?void 0:r.message)||"發生錯誤",snackbarProps:{color:"red"}})}M.value=!1};return i(),(o,e)=>{const d=W("vue-file-agent");return L(),X(h,null,[l(Y,null,{default:s(()=>[l(ae,null,{default:s(()=>[l(N,{cols:"12"},{default:s(()=>[l(N,{cols:"12",class:"d-flex justify-end"},{default:s(()=>[l(C,{color:"black",onClick:e[0]||(e[0]=a=>D(null))},{default:s(()=>[w("新增業績")]),_:1})]),_:1}),l(Ve,{"items-per-page":B.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=a=>B.value=a),e[7]||(e[7]=a=>i(!1))],"sort-by":b.value,"onUpdate:sortBy":[e[5]||(e[5]=a=>b.value=a),e[8]||(e[8]=a=>i(!1))],page:k.value,"onUpdate:page":[e[6]||(e[6]=a=>k.value=a),e[9]||(e[9]=a=>i(!1))],items:F.value,headers:G,loading:M.value,"items-length":z.value,search:x.value,hover:""},{top:s(()=>[l(P,{label:"搜尋",modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),"append-icon":"mdi-magnify",onClickAppend:e[2]||(e[2]=a=>i(!0)),onKeydown:e[3]||(e[3]=le(a=>i(!0),["enter"])),class:"custom-search"},null,8,["modelValue"])]),"item.image":s(({value:a})=>[l(te,{src:a,height:"55px"},null,8,["src"])]),"item.sell":s(({value:a})=>[a?(L(),oe(pe,{key:0,icon:"mdi-check"})):re("",!0)]),"item.action":s(({item:a})=>[l(C,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:r=>D(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(_,{modelValue:n.value.open,"onUpdate:modelValue":e[17]||(e[17]=a=>n.value.open=a),persistent:"",width:"500"},{default:s(()=>[l(be,{onSubmit:se(t(Z),["prevent"]),disabled:t($)},{default:s(()=>[l(ne,null,{default:s(()=>[l(ue,null,{default:s(()=>[w(ie(n.value.id?"編輯":"新增"),1)]),_:1}),l(de,null,{default:s(()=>[l(P,{label:"名稱",modelValue:t(g).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>t(g).value.value=a),"error-messages":t(g).errorMessage.value},null,8,["modelValue","error-messages"]),l(P,{label:"年份",type:"number",min:"0",modelValue:t(c).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>t(c).value.value=a),"error-messages":t(c).errorMessage.value},null,8,["modelValue","error-messages"]),l(ke,{label:"分類",items:q,modelValue:t(V).value.value,"onUpdate:modelValue":e[12]||(e[12]=a=>t(V).value.value=a),"error-messages":t(V).errorMessage.value},null,8,["modelValue","error-messages"]),l(ye,{label:"新增",modelValue:t(y).value.value,"onUpdate:modelValue":e[13]||(e[13]=a=>t(y).value.value=a),"error-messages":t(y).errorMessage.value},null,8,["modelValue","error-messages"]),l(xe,{label:"說明",modelValue:t(f).value.value,"onUpdate:modelValue":e[14]||(e[14]=a=>t(f).value.value=a),"error-messages":t(f).errorMessage.value},null,8,["modelValue","error-messages"]),l(d,{modelValue:p.value,"onUpdate:modelValue":e[15]||(e[15]=a=>p.value=a),"raw-model-value":R.value,"onUpdate:rawModelValue":e[16]||(e[16]=a=>R.value=a),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:I},null,8,["modelValue","raw-model-value"])]),_:1}),l(me,null,{default:s(()=>[l(C,{color:"red",loading:t($),onClick:T},{default:s(()=>[w("取消")]),_:1},8,["loading"]),l(C,{color:"green",type:"submit",loading:t($)},{default:s(()=>[w("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64)}}};typeof j=="function"&&j(E);const De=J(E,[["__scopeId","data-v-9b9fafea"]]);export{De as default};
